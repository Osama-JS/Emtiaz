@model Emtias.Models.Scaffolded.Restaurant
@using Emtias.Models.Scaffolded

@{
    ViewData["Title"] = "تفاصيل المطعم";
}

<!-- Page Title -->
<div class="pagetitle">
    <h1>تفاصيل المطعم</h1>
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">الرئيسية</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">المطاعم</a></li>
            <li class="breadcrumb-item active">@Model.Name</li>
        </ol>
    </nav>
</div><!-- End Page Title -->

<section class="section">
    <div class="row">
        <!-- Restaurant Header Card -->
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            @if (!string.IsNullOrEmpty(Model.IconLink))
                            {
                                <img src="@Model.IconLink" alt="@Model.Name" class="restaurant-icon-large rounded-3 shadow" style="width: 120px; height: 120px; object-fit: cover;" onerror="showDefaultIcon(this)">
                            }
                            else
                            {
                                <div class="restaurant-icon-placeholder-large rounded-3 d-flex align-items-center justify-content-center shadow-sm" style="width: 120px; height: 120px; background-color: #f8f9fa; border: 2px dashed #dee2e6;">
                                    <i class="bi bi-shop text-muted" style="font-size: 3rem;"></i>
                                </div>
                            }
                        </div>
                        <div class="col-md-8">
                            <h2 class="mb-2">@Model.Name</h2>
                            @if (!string.IsNullOrEmpty(Model.EnName))
                            {
                                <h5 class="text-muted mb-3">@Model.EnName</h5>
                            }
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                @if (Model.Catgory != null)
                                {
                                    <span class="badge bg-primary fs-6">
                                        <i class="bi bi-tag me-1"></i>
                                        @Model.Catgory.Name
                                    </span>
                                }
                                <span class="badge @(Model.Deleted ? "bg-danger" : "bg-success") fs-6">
                                    <i class="bi bi-@(Model.Deleted ? "x-circle" : "check-circle") me-1"></i>
                                    @(Model.Deleted ? "محذوف" : "نشط")
                                </span>
                            </div>
                            @if (!string.IsNullOrEmpty(Model.Address))
                            {
                                <p class="text-muted mb-2">
                                    <i class="bi bi-geo-alt me-2"></i>
                                    @Model.Address
                                </p>
                            }
                            @if (!string.IsNullOrEmpty(Model.Lat) && !string.IsNullOrEmpty(Model.Lng))
                            {
                                <p class="text-muted mb-0">
                                    <i class="bi bi-pin-map me-2"></i>
                                    الإحداثيات: @Model.Lat, @Model.Lng
                                </p>
                            }
                        </div>
                        <div class="col-md-2 text-end">
                            <div class="btn-group-vertical w-100" role="group">
                                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning mb-2">
                                    <i class="bi bi-pencil me-1"></i>
                                    تعديل
                                </a>
                                <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger">
                                    <i class="bi bi-trash me-1"></i>
                                    حذف
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="col-12">
            <div class="row">
                <div class="col-md-3">
                    <div class="card info-card sales-card">
                        <div class="card-body">
                            <h5 class="card-title">المنتجات</h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-box"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>@(Model.Products?.Count ?? 0)</h6>
                                    <span class="text-success small pt-1 fw-bold">منتج</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card info-card revenue-card">
                        <div class="card-body">
                            <h5 class="card-title">العروض</h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-percent"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>@(Model.Offers?.Count ?? 0)</h6>
                                    <span class="text-primary small pt-1 fw-bold">عرض</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card info-card customers-card">
                        <div class="card-body">
                            <h5 class="card-title">الحجوزات</h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-calendar2-event"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>@(Model.Reservations?.Count ?? 0)</h6>
                                    <span class="text-danger small pt-1 fw-bold">حجز</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card info-card">
                        <div class="card-body">
                            <h5 class="card-title">التعليقات</h5>
                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-chat-dots"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>@(Model.RestaurantsComments?.Count ?? 0)</h6>
                                    <span class="text-warning small pt-1 fw-bold">تعليق</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Restaurant Details -->
        @if (!string.IsNullOrEmpty(Model.Details))
        {
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-info-circle me-2"></i>
                            تفاصيل المطعم
                        </h5>
                        <p class="card-text">@Model.Details</p>
                    </div>
                </div>
            </div>
        }

        <!-- Location Map (if coordinates available) -->
        @if (!string.IsNullOrEmpty(Model.Lat) && !string.IsNullOrEmpty(Model.Lng))
        {
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="bi bi-geo-alt me-2"></i>
                            الموقع الجغرافي
                        </h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="location-info">
                                    <p><strong>خط العرض:</strong> @Model.Lat</p>
                                    <p><strong>خط الطول:</strong> @Model.Lng</p>
                                    @if (!string.IsNullOrEmpty(Model.Address))
                                    {
                                        <p><strong>العنوان:</strong> @Model.Address</p>
                                    }
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="map-actions">
                                    <a href="https://www.google.com/maps?q=@Model.Lat,@Model.Lng" target="_blank" class="btn btn-outline-primary me-2">
                                        <i class="bi bi-map me-1"></i>
                                        عرض في خرائط جوجل
                                    </a>
                                    <button type="button" class="btn btn-outline-secondary" onclick="copyCoordinates()">
                                        <i class="bi bi-clipboard me-1"></i>
                                        نسخ الإحداثيات
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Recent Products -->
        @if (Model.Products != null && Model.Products.Any())
        {
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-box me-2"></i>
                                المنتجات (@(Model.Products?.Count ?? 0))
                            </h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">عرض الكل</a>
                        </div>
                        <div class="row">
                            @foreach (var product in (Model.Products ?? new List<Product>()).Take(6))
                            {
                                <div class="col-md-4 mb-3">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body p-3">
                                            <h6 class="card-title">@product.Name</h6>
                                            @if (!string.IsNullOrEmpty(product.EnName))
                                            {
                                                <p class="card-text text-muted small">@product.EnName</p>
                                            }
                                            
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Recent Comments -->
        @if (Model.RestaurantsComments != null && Model.RestaurantsComments.Any())
        {
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-chat-dots me-2"></i>
                                آخر التعليقات (@(Model.RestaurantsComments?.Count ?? 0))
                            </h5>
                            <a href="#" class="btn btn-sm btn-outline-primary">عرض الكل</a>
                        </div>
                        @foreach (var comment in (Model.RestaurantsComments ?? new List<RestaurantsComment>()).Take(3))
                        {
                            <div class="comment-item border-bottom pb-3 mb-3">
                                <div class="d-flex align-items-start">
                                    <div class="avatar-placeholder rounded-circle me-3" style="width: 40px; height: 40px; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                                        <i class="bi bi-person text-muted"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">مستخدم</h6>
                                        <p class="mb-1">@comment.Comment</p>
                                        <small class="text-muted">@comment.CommentDate?.ToString("dd/MM/yyyy")</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }

        <!-- Action Buttons -->
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-arrow-left me-1"></i>
                            العودة للقائمة
                        </a>
                        <div>
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning me-2">
                                <i class="bi bi-pencil me-1"></i>
                                تعديل المطعم
                            </a>
                            <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                                <i class="bi bi-trash me-1"></i>
                                حذف المطعم
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // Show default icon when image fails to load
        function showDefaultIcon(img) {
            const container = img.parentElement;
            container.innerHTML = `
                <div class="restaurant-icon-placeholder-large rounded-3 d-flex align-items-center justify-content-center shadow-sm" style="width: 120px; height: 120px; background-color: #f8f9fa; border: 2px dashed #dee2e6;">
                    <i class="bi bi-shop text-muted" style="font-size: 3rem;"></i>
                </div>
            `;
        }

        // Copy coordinates to clipboard
        function copyCoordinates() {
            const lat = '@Model.Lat';
            const lng = '@Model.Lng';
            const coordinates = `${lat}, ${lng}`;

            navigator.clipboard.writeText(coordinates).then(function() {
                Swal.fire({
                    icon: 'success',
                    title: 'تم النسخ!',
                    text: 'تم نسخ الإحداثيات إلى الحافظة',
                    timer: 2000,
                    showConfirmButton: false
                });
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'لم يتم نسخ الإحداثيات'
                });
            });
        }

        // Confirm delete
        function confirmDelete() {
            Swal.fire({
                title: 'هل أنت متأكد؟',
                text: 'سيتم حذف المطعم "@Model.Name" نهائياً!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'نعم، احذف المطعم',
                cancelButtonText: 'إلغاء'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '@Url.Action("Delete", new { id = Model.Id })';
                }
            });
        }
    </script>
}
